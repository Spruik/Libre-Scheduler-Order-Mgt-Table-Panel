{"version":3,"sources":["../src/table_ctrl.js"],"names":["allData","_reconstructed_data","refreshDashboard","_ctrl","timeSrv","_","$","moment","MetricsPanelCtrl","transformDataToTable","tablePanelEditor","columnOptionsTab","TableRenderer","showOrderEditingForm","showActionOptionsForm","utils","cons","panelDefaults","targets","transform","pageSize","showHeader","styles","type","pattern","alias","dateFormat","headerColor","unit","decimals","colors","colorMode","thresholds","columns","scroll","fontSize","sort","col","desc","TableCtrl","$scope","$injector","templateSrv","annotationsSrv","$sanitize","variableSrv","pageIndex","panel","fields","defaults","events","on","onDataReceived","bind","onDataError","onInitEditMode","onInitPanelActions","document","off","e","rowData","map","index","td","childNodes","length","nodeValue","text","prodLineIndex","ctrl","colDimensions","indexOf","orderIdIndex","prodDescIndex","prodIdIndex","alert","addEditorTab","actions","push","click","datasource","setTimeQueryStart","getAnnotations","dashboard","range","then","data","annotations","err","dataRaw","render","dataList","reorderData","filter","reconstruct","queryProductionLineDetails","findIndex","toLowerCase","pro_line_col","splice","i","rows","row","pro_line_row","lowerCaseRow","elem","STATE_REPLACED","STATE_DELETED","key","cols","find","a","b","entries","table","renderer","isTimezoneUtc","colIndex","scope","$new","tableData","render_values","publishAppEvent","templateHtml","modalClass","attrs","pageCount","getTableHeight","panelHeight","height","appendTableRows","tbodyElem","setTable","empty","html","switchPage","el","currentTarget","parseInt","renderPanel","appendPaginationControls","footerElem","Math","ceil","startPage","max","endPage","min","paginationList","activeClass","pageLinkElem","append","panelElem","parents","rootElem","css","addClass","split","x","hidden","tooltip","selector","addFilterClicked","filterData","options","column","value","operator","setAdhocFilter","unbindDestroy","$on","renderData","renderingCompleted","templateUrl"],"mappings":"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","file":"table_ctrl.js","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\nimport moment from 'moment';\nimport { MetricsPanelCtrl } from 'app/plugins/sdk';\nimport { transformDataToTable } from './transformers';\nimport { tablePanelEditor } from './editor';\nimport { columnOptionsTab } from './column_options';\nimport { TableRenderer } from './renderer';\nimport { showOrderEditingForm } from './order_form_ctrl';\nimport { showActionOptionsForm } from './action_options_form_ctrl';\n\nimport * as utils from './utils';\nimport * as cons from './constants';\n\nimport './css/style.css!';\nimport './css/instant-serach.css!';\nimport './css/datepicker.css!';\nimport './css/timepicker.css!';\n\nconst panelDefaults = {\n  targets: [{}],\n  transform: 'timeseries_to_columns',\n  pageSize: null,\n  showHeader: true,\n  styles: [\n    {\n      type: 'date',\n      pattern: 'Time',\n      alias: 'Time',\n      dateFormat: 'YYYY-MM-DD HH:mm:ss',\n      headerColor: 'rgba(51, 181, 229, 1)'\n    },\n    {\n      unit: 'short',\n      type: 'number',\n      alias: '',\n      decimals: 2,\n      headerColor: 'rgba(51, 181, 229, 1)',\n      colors: [\n        'rgba(245, 54, 54, 0.9)',\n        'rgba(237, 129, 40, 0.89)',\n        'rgba(50, 172, 45, 0.97)'\n      ],\n      colorMode: null,\n      pattern: '/.*/',\n      thresholds: []\n    }\n  ],\n  columns: [],\n  scroll: true,\n  fontSize: '100%',\n  sort: { col: 0, desc: true }\n};\n\nlet _reconstructed_data;\nlet _ctrl;\n\nexport class TableCtrl extends MetricsPanelCtrl {\n  constructor(\n    $scope,\n    $injector,\n    templateSrv,\n    annotationsSrv,\n    $sanitize,\n    variableSrv\n  ) {\n    super($scope, $injector);\n\n    this.pageIndex = 0;\n\n    if (this.panel.styles === void 0) {\n      this.panel.styles = this.panel.columns;\n      this.panel.columns = this.panel.fields;\n      delete this.panel.columns;\n      delete this.panel.fields;\n    }\n\n    _.defaults(this.panel, panelDefaults);\n\n    this.events.on('data-received', this.onDataReceived.bind(this));\n    this.events.on('data-error', this.onDataError.bind(this));\n    this.events.on('data-snapshot-load', this.onDataReceived.bind(this));\n    this.events.on('init-edit-mode', this.onInitEditMode.bind(this));\n    this.events.on('init-panel-actions', this.onInitPanelActions.bind(this));\n\n    //Remove listener before add it\n    $(document).off('click', 'tr.tr-affect#order-mgt-scheduler-table-tr');\n    $(document).off('click', 'i.add-order-btn');\n    //Show form if a row is clicked\n    $(document).on(\n      'click',\n      'tr.tr-affect#order-mgt-scheduler-table-tr',\n      function(e) {\n        const rowData = $('td', this).map((index, td) => {\n          if (td.childNodes.length === 2) {\n            return td.childNodes[1].nodeValue;\n          } else if (td.childNodes.length === 1) {\n            return $(td).text();\n          } else {\n            return '';\n          }\n        });\n\n        const prodLineIndex = $scope.ctrl.colDimensions.indexOf(\n          'production_line'\n        );\n        const orderIdIndex = $scope.ctrl.colDimensions.indexOf('order_id');\n        const prodDescIndex = $scope.ctrl.colDimensions.indexOf('product_desc');\n        const prodIdIndex = $scope.ctrl.colDimensions.indexOf('product_id');\n        if (\n          !~prodLineIndex ||\n          !~orderIdIndex ||\n          !~prodDescIndex ||\n          !~prodIdIndex\n        ) {\n          utils.alert(\n            'error',\n            'Error',\n            'Get not get this order from the database, please contact the dev team'\n          );\n          return;\n        } else {\n          showActionOptionsForm(\n            rowData[prodLineIndex],\n            rowData[orderIdIndex],\n            rowData[prodDescIndex],\n            rowData[prodIdIndex]\n          );\n        }\n      }\n    );\n\n    //Show form with no data when the add btn is clicked\n    $(document).on('click', 'i.add-order-btn', function() {\n      showOrderEditingForm('', allData());\n    });\n  }\n\n  onInitEditMode() {\n    this.addEditorTab('Options', tablePanelEditor, 2);\n    this.addEditorTab('Column Styles', columnOptionsTab, 3);\n  }\n\n  onInitPanelActions(actions) {\n    actions.push({ text: 'Export CSV', click: 'ctrl.exportCsv()' });\n  }\n\n  issueQueries(datasource) {\n    this.pageIndex = 0;\n\n    if (this.panel.transform === 'annotations') {\n      this.setTimeQueryStart();\n      return this.annotationsSrv\n        .getAnnotations({\n          dashboard: this.dashboard,\n          panel: this.panel,\n          range: this.range\n        })\n        .then(annotations => {\n          return { data: annotations };\n        });\n    }\n\n    return super.issueQueries(datasource);\n  }\n\n  onDataError(err) {\n    this.dataRaw = [];\n    this.render();\n  }\n\n  onDataReceived(dataList) {\n    dataList = this.reorderData(dataList); // put production line in the first column\n    dataList = this.filter(dataList); // filter out those with status of 'replaced' or 'deleted' and those that are not in the time range\n    dataList = this.sort(dataList, 'scheduled_start_datetime'); // sort rows so that all rows are sort/order by scheduled_start_time\n\n    _reconstructed_data = utils.reconstruct(dataList);\n\n    this.dataRaw = dataList;\n    this.pageIndex = 0;\n\n    // automatically correct transform mode based on data\n    if (this.dataRaw && this.dataRaw.length) {\n      if (this.dataRaw[0].type === 'table') {\n        this.panel.transform = 'table';\n      } else {\n        if (this.dataRaw[0].type === 'docs') {\n          this.panel.transform = 'json';\n        } else {\n          if (\n            this.panel.transform === 'table' ||\n            this.panel.transform === 'json'\n          ) {\n            this.panel.transform = 'timeseries_to_rows';\n          }\n        }\n      }\n    }\n\n    utils.queryProductionLineDetails();\n\n    this.render();\n  }\n\n  //Reorder the column to put the productionLine go first.\n  reorderData(dataList) {\n    if (dataList.length === 0) {\n      return dataList;\n    }\n\n    if (dataList[0].columns) {\n      let index = dataList[0].columns.findIndex(\n        col => col.text.toLowerCase() === 'production_line'\n      );\n      if (index !== -1) {\n        //store data\n        let pro_line_col = dataList[0].columns[index];\n        //remove data from original position\n        dataList[0].columns.splice(index, 1);\n        //insert data to index 1 with the stored obj\n        dataList[0].columns.splice(1, 0, pro_line_col);\n\n        //reorder for each row data\n        for (let i = 0; i < dataList[0].rows.length; i++) {\n          const row = dataList[0].rows[i];\n          let pro_line_row = row[index];\n          row.splice(index, 1);\n          row.splice(1, 0, pro_line_row);\n        }\n      }\n    }\n    return dataList;\n  }\n\n  // filter out records that are not of status of 'Replaced'\n  filter(dataList) {\n    if (dataList.length === 0) {\n      return dataList;\n    }\n\n    let rows = dataList[0].rows;\n    rows = rows.filter(row => {\n      const lowerCaseRow = row.map(elem =>\n        typeof elem === 'string' ? elem.toLowerCase() : elem\n      );\n      if (\n        lowerCaseRow.indexOf(cons.STATE_REPLACED) === -1 &&\n        lowerCaseRow.indexOf(cons.STATE_DELETED) === -1\n      ) {\n        return row;\n      }\n    });\n    dataList[0].rows = rows;\n    return dataList;\n  }\n\n  //sort by schedule start time\n  sort(dataList, key) {\n    if (dataList.length === 0) {\n      return dataList;\n    }\n\n    const cols = dataList[0].columns;\n    const index = this.find(key, cols);\n    dataList[0].rows.sort((a, b) => a[index] - b[index]);\n\n    return dataList;\n  }\n\n  //find index related to the key in the columns\n  find(key, cols) {\n    let index = 0;\n    for (const [i, col] of cols.entries()) {\n      if (col.text === key) {\n        index = i;\n        break;\n      }\n    }\n    return index;\n  }\n\n  render() {\n    this.table = transformDataToTable(this.dataRaw, this.panel);\n    // this.table.sort(this.panel.sort);\n    this.renderer = new TableRenderer(\n      this.panel,\n      this.table,\n      this.dashboard.isTimezoneUtc(),\n      this.$sanitize,\n      this.templateSrv,\n      this.col\n    );\n\n    return super.render(this.table);\n  }\n\n  toggleColumnSort(col, colIndex) {\n    // remove sort flag from current column\n    if (this.table.columns[this.panel.sort.col]) {\n      this.table.columns[this.panel.sort.col].sort = false;\n    }\n\n    if (this.panel.sort.col === colIndex) {\n      if (this.panel.sort.desc) {\n        this.panel.sort.desc = false;\n      } else {\n        this.panel.sort.col = null;\n      }\n    } else {\n      this.panel.sort.col = colIndex;\n      this.panel.sort.desc = true;\n    }\n    this.render();\n  }\n\n  exportCsv() {\n    const scope = this.$scope.$new(true);\n    scope.tableData = this.renderer.render_values();\n    scope.panel = 'table';\n    this.publishAppEvent('show-modal', {\n      templateHtml:\n        '<export-data-modal panel=\"panel\" data=\"tableData\"></export-data-modal>',\n      scope,\n      modalClass: 'modal--narrow'\n    });\n  }\n\n  link(scope, elem, attrs, ctrl) {\n    let data;\n    const panel = ctrl.panel;\n    let pageCount = 0;\n    _ctrl = ctrl;\n\n    function getTableHeight() {\n      let panelHeight = ctrl.height;\n\n      if (pageCount > 1) {\n        panelHeight -= 26;\n      }\n\n      return panelHeight - 31 + 'px';\n    }\n\n    function appendTableRows(tbodyElem) {\n      ctrl.renderer.setTable(data);\n      tbodyElem.empty();\n      tbodyElem.html(ctrl.renderer.render(ctrl.pageIndex));\n    }\n\n    function switchPage(e) {\n      const el = $(e.currentTarget);\n      ctrl.pageIndex = parseInt(el.text(), 10) - 1;\n      renderPanel();\n    }\n\n    function appendPaginationControls(footerElem) {\n      footerElem.empty();\n\n      const pageSize = panel.pageSize || 100;\n      pageCount = Math.ceil(data.rows.length / pageSize);\n      if (pageCount === 1) {\n        return;\n      }\n\n      const startPage = Math.max(ctrl.pageIndex - 3, 0);\n      const endPage = Math.min(pageCount, startPage + 9);\n\n      const paginationList = $('<ul></ul>');\n\n      for (let i = startPage; i < endPage; i++) {\n        const activeClass = i === ctrl.pageIndex ? 'active' : '';\n        const pageLinkElem = $(\n          '<li><a class=\"table-panel-page-link pointer ' +\n            activeClass +\n            '\">' +\n            (i + 1) +\n            '</a></li>'\n        );\n        paginationList.append(pageLinkElem);\n      }\n\n      footerElem.append(paginationList);\n    }\n\n    function renderPanel() {\n      const panelElem = elem.parents('.panel-content');\n      const rootElem = elem.find('.table-panel-scroll');\n      const tbodyElem = elem.find('tbody');\n      const footerElem = elem.find('.table-panel-footer');\n\n      elem.css({ 'font-size': panel.fontSize });\n      panelElem.addClass('table-panel-content');\n\n      appendTableRows(tbodyElem);\n      appendPaginationControls(footerElem);\n\n      const height = parseInt(getTableHeight().split('px')[0]) - 38 + 'px';\n      rootElem.css({ 'max-height': panel.scroll ? height : '' });\n\n      // get current table column dimensions\n      if (ctrl.table.columns) {\n        ctrl.colDimensions = ctrl.table.columns\n          .filter(x => !x.hidden)\n          .map(x => x.text);\n      }\n    }\n\n    // hook up link tooltips\n    elem.tooltip({\n      selector: '[data-link-tooltip]'\n    });\n\n    function addFilterClicked(e) {\n      const filterData = $(e.currentTarget).data();\n      const options = {\n        datasource: panel.datasource,\n        key: data.columns[filterData.column].text,\n        value: data.rows[filterData.row][filterData.column],\n        operator: filterData.operator\n      };\n\n      ctrl.variableSrv.setAdhocFilter(options);\n    }\n\n    elem.on('click', '.table-panel-page-link', switchPage);\n    elem.on('click', '.table-panel-filter-link', addFilterClicked);\n\n    const unbindDestroy = scope.$on('$destroy', () => {\n      elem.off('click', '.table-panel-page-link');\n      elem.off('click', '.table-panel-filter-link');\n      unbindDestroy();\n    });\n\n    ctrl.events.on('render', renderData => {\n      data = renderData || data;\n      if (data) {\n        renderPanel();\n      }\n      ctrl.renderingCompleted();\n    });\n  }\n}\n\nexport function allData() {\n  return _reconstructed_data;\n}\n\nexport function refreshDashboard() {\n  _ctrl.timeSrv.refreshDashboard();\n}\n\nTableCtrl.templateUrl = './partials/module.html';\n"]}